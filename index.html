<!DOCTYPE html>
<html>
    <head>
        <title>Hack-a-Ton(ne)</title>
        <style type='text/css'>body{margin:0;padding:0;overflow:hidden;font-family:'Segoe UI',Helvetica,Arial,Sans-Serif}</style>
        <meta http-equiv='Content-Type' content='text/html; charset=utf-8'/>
        <script type='text/javascript' src='https://www.bing.com/api/maps/mapcontrol?key=Ao3eNYIGJwOXJTGo1ZTN3gj0tvo-Uml0dykcHwPhJhEWWRJ-sq0X3bdawiqaG-9P'></script>
        <script type='text/javascript'>
                var map, infobox, infobox2, dataLayer;
		
                function loadMapScenario() {
                    map = new Microsoft.Maps.Map(document.getElementById('myMap'), {});
		    
		    map.setView({
            //mapTypeId: Microsoft.Maps.MapTypeId.aerial,
            center: new Microsoft.Maps.Location(53.849759, 10.672344),
            zoom: 13
        });
		    
		    
		var infoboxLayer = new Microsoft.Maps.EntityCollection();
		map.entities.push(infoboxLayer);
	
		infobox = new Microsoft.Maps.Infobox(new Microsoft.Maps.Location(0, 0), { maxHeight: 400, maxWidth: 900, visible: false, offset: new Microsoft.Maps.Point(0, 20) });
		infoboxLayer.push(infobox);
		
		map.entities.push(new Microsoft.Maps.Pushpin({'latitude': 53.866275, 'longitude':  10.679631}, {icon: 'holsten_small.png'}));
		map.entities.push(new Microsoft.Maps.Pushpin({'latitude': 53.855677, 'longitude':  10.680965}, {icon: 'possehl_small.png'}));
		map.entities.push(new Microsoft.Maps.Pushpin({'latitude': 53.875117, 'longitude':  10.691085}, {icon: 'hub_small.png'}));
		
		var coordinates = [
		{pos: {'latitude':  53.851505, 'longitude': 10.672717}, data: [{channel: '119', chart: '1'}, {channel: '119', chart: '2'}], color: 'yellow'},
		
		{pos: {'latitude': 54.848247, 'longitude': 10.688049}, data: [{channel: '63', chart: '1'}], color: 'green'},
		{pos: {'latitude': 53.851093, 'longitude': 10.671138}, data: [{channel: '63', chart: '1'}], color: 'green'},
		{pos: {'latitude': 53.852661, 'longitude': 10.673736}, data: [{channel: '63', chart: '1'}], color: 'green'},
		{pos: {'latitude': 53.849615, 'longitude': 10.668617}, data: [{channel: '63', chart: '1'}], color: 'green'},
		{pos: {'latitude': 53.855133, 'longitude': 10.678785}, data: [{channel: '63', chart: '1'}], color: 'green'},
		{pos: {'latitude': 53.856900, 'longitude': 10.685482}, data: [{channel: '63', chart: '1'}], color: 'grey'},
		{pos: {'latitude': 53.861098, 'longitude': 10.678355}, data: [{channel: '63', chart: '1'}], color: 'grey'},
		{pos: {'latitude': 53.865070, 'longitude':  10.680455}, data: [{channel: '63', chart: '1'}], color: 'grey'},
		{pos: {'latitude': 53.867770, 'longitude': 10.679639}, data: [{channel: '63', chart: '1'}], color: 'grey'},
		{pos: {'latitude': 53.871832, 'longitude': 10.681353}, data: [{channel: '63', chart: '1'}], color: 'grey'},
		{pos: {'latitude': 53.875470, 'longitude':  10.689630}, data: [{channel: '63', chart: '1'}], color: 'grey'},
		{pos: {'latitude': 53.883262, 'longitude': 10.691673}, data: [{channel: '63', chart: '1'}], color: 'grey'},
		{pos: {'latitude': 53.889961, 'longitude': 10.702062}, data: [{channel: '63', chart: '1'}], color: 'grey'},
		{pos: {'latitude': 53.860659, 'longitude':  10.692414}, data: [{channel: '63', chart: '1'}], color: 'grey'},
		{pos: {'latitude': 53.864287, 'longitude': 10.694915}, data: [{channel: '63', chart: '1'}], color: 'grey'},
		{pos: {'latitude': 53.866781, 'longitude':  10.696851}, data: [{channel: '63', chart: '1'}], color: 'grey'},
		{pos: {'latitude': 53.869772, 'longitude':  10.697226}, data: [{channel: '63', chart: '1'}], color: 'grey'},
		{pos: {'latitude': 53.873450, 'longitude':  10.694134}, data: [{channel: '63', chart: '1'}], color: 'grey'},
		{pos: {'latitude': 53.880299, 'longitude':  10.689950}, data: [{channel: '63', chart: '1'}], color: 'grey'},
		{pos: {'latitude': 53.884644, 'longitude':  10.693503}, data: [{channel: '63', chart: '1'}], color: 'grey'},
		{pos: {'latitude': 53.886006, 'longitude': 10.696317}, data: [{channel: '63', chart: '1'}], color: 'grey'},
		
		{pos: {'latitude': 53.847027, 'longitude':  10.664481}, data: [{channel: '63', chart: '1'}], color: 'grey'},
		{pos: {'latitude': 53.846056, 'longitude':  10.662493}, data: [{channel: '63', chart: '1'}], color: 'grey'},
		{pos: {'latitude': 53.845410, 'longitude':  10.657408}, data: [{channel: '63', chart: '1'}], color: 'grey'},
		{pos: {'latitude': 53.845198, 'longitude':  10.649419}, data: [{channel: '63', chart: '1'}], color: 'grey'},
		{pos: {'latitude': 53.843908, 'longitude':  10.645787}, data: [{channel: '63', chart: '1'}], color: 'grey'},
		{pos: {'latitude': 53.842100, 'longitude':  10.643952}, data: [{channel: '63', chart: '1'}], color: 'grey'},
		{pos: {'latitude': 53.838459, 'longitude':  10.643641}, data: [{channel: '63', chart: '1'}], color: 'grey'},
		
		{pos: {'latitude': 53.834250, 'longitude':  10.643374}, data: [{channel: '63', chart: '1'}], color: 'grey'},
		{pos: {'latitude': 53.831695, 'longitude':  10.641192}, data: [{channel: '63', chart: '1'}], color: 'grey'},
		{pos: {'latitude': 53.827761, 'longitude':  10.637509}, data: [{channel: '63', chart: '1'}], color: 'grey'},
		{pos: {'latitude': 53.824304, 'longitude':  10.634297}, data: [{channel: '63', chart: '1'}], color: 'grey'},
		{pos: {'latitude': 53.818430, 'longitude':  10.626140}, data: [{channel: '63', chart: '1'}], color: 'grey'}
		
		
		];
		
		for  ( var coordinate of coordinates) {
			var pin = new Microsoft.Maps.Pushpin(coordinate.pos, {color: coordinate.color});
			pin.hackData = coordinate.data;
			map.entities.push(pin);
			Microsoft.Maps.Events.addHandler(pin, 'click', displayHackATonneInfo);
		};
		

		function displayHackATonneInfo(e) {
		var selectedInfoBox = infobox;
		      if (e.targetType == 'pushpin') {
		         var hackData = e.target.hackData;
			
			selectedInfoBox.setLocation(e.target.getLocation());
			  
			
			  var fullDescription = '';
			  for (var datum of hackData) {
				fullDescription +=  '<iframe width="400" height="300" style="border: 1px solid #cccccc;" src="http://iot.fh-luebeck.de/channels/'+datum.channel+'/charts/'+datum.chart+'?width=400&height=300&results=60&dynamic=true" ></iframe>' 
			  }
			  selectedInfoBox.setOptions({ visible: true, title: "Hack-A-Ton(ne)", 
			
			  description: fullDescription});
		      }
		  } 

                }
                
            
        </script>
    </head>
    <body onload='loadMapScenario();'>
        <div id='printoutPanel'></div>
        
        <div id='myMap' style='width: 100vw; height: 100vh;'></div>
    </body>
</html>